# è¡¨å¤´æ˜¾ç¤ºæ–‡ä»¶ååŠŸèƒ½è¯´æ˜

## ğŸ“ åŠŸèƒ½æè¿°

åœ¨æ¯”å¯¹ç»“æœExcelæ–‡ä»¶ä¸­ï¼Œè¡¨å¤´å°†æ˜¾ç¤º**å®é™…ä¸Šä¼ çš„æ–‡ä»¶å**ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„"A"å’Œ"B"ã€‚

## ğŸ¯ ä¿®æ”¹å‰åå¯¹æ¯”

### ä¿®æ”¹å‰ âŒ
```
| æŒ‡æ ‡åç§° | A | B | å·®é¢(A-B) | å·®å¼‚% |
```

### ä¿®æ”¹å âœ…
```
| æŒ‡æ ‡åç§° | test_data_a | test_data_b | å·®é¢(test_data_a-test_data_b) | å·®å¼‚% |
```

**ç¤ºä¾‹ï¼š**
- ä¸Šä¼ æ–‡ä»¶1ï¼š`2024å¹´æ•°æ®.xlsx`
- ä¸Šä¼ æ–‡ä»¶2ï¼š`2023å¹´æ•°æ®.xlsx`

**ç»“æœè¡¨å¤´ï¼š**
```
| æŒ‡æ ‡åç§° | 2024å¹´æ•°æ® | 2023å¹´æ•°æ® | å·®é¢(2024å¹´æ•°æ®-2023å¹´æ•°æ®) | å·®å¼‚% |
```

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æå–æ–‡ä»¶å

åœ¨ `run_compare` æ–¹æ³•ä¸­ï¼š
```python
# ä»å®Œæ•´è·¯å¾„ä¸­æå–æ–‡ä»¶åï¼Œå¹¶ç§»é™¤æ‰©å±•å
data_a_name = os.path.basename(data_a_file).replace('.xlsx', '').replace('.xls', '')
data_b_name = os.path.basename(data_b_file).replace('.xlsx', '').replace('.xls', '')
```

**ç¤ºä¾‹ï¼š**
- è¾“å…¥ï¼š`E:\data-compare\test\2024å¹´æ•°æ®.xlsx`
- è¾“å‡ºï¼š`2024å¹´æ•°æ®`

### 2. ä¼ é€’ç»™ç»“æœç”Ÿæˆæ–¹æ³•

```python
self._create_result(output_path, base_names, data_a, data_b, 
                   decimal_places, green_th, 
                   data_a_name, data_b_name)  # æ–°å¢å‚æ•°
```

### 3. åœ¨è¡¨å¤´ä¸­ä½¿ç”¨

```python
def _create_result(self, output, names, data_a, data_b, decimal_places, green_th, 
                  data_a_name='A', data_b_name='B'):  # é»˜è®¤å€¼ä¿æŒå…¼å®¹
    # ...
    headers = ["æŒ‡æ ‡åç§°", data_a_name, data_b_name, 
              f"å·®é¢({data_a_name}-{data_b_name})", "å·®å¼‚%"]
```

### 4. æ›´æ–°å›¾ä¾‹è¯´æ˜

å›¾ä¾‹ä¸­çš„è¯´æ˜ä¹Ÿä¼šä½¿ç”¨å®é™…æ–‡ä»¶åï¼š
```python
# æ—§ï¼šA=B æˆ– |å·®å¼‚%|<1.0%
# æ–°ï¼š2024å¹´æ•°æ®=2023å¹´æ•°æ® æˆ– |å·®å¼‚%|<1.0%
cell_g1.value = "{}={} æˆ– |å·®å¼‚%|<{}%".format(data_a_name, data_b_name, green_th)
```

## ğŸ“Š æ•ˆæœå±•ç¤º

### å®Œæ•´çš„ç»“æœæ–‡ä»¶è¡¨å¤´

å‡è®¾ä¸Šä¼ çš„æ–‡ä»¶ä¸ºï¼š
- `è´¢åŠ¡æ•°æ®_Q1.xlsx`
- `è´¢åŠ¡æ•°æ®_Q2.xlsx`

**Excelç»“æœæ–‡ä»¶ï¼š**

| æŒ‡æ ‡åç§° | è´¢åŠ¡æ•°æ®_Q1 | è´¢åŠ¡æ•°æ®_Q2 | å·®é¢(è´¢åŠ¡æ•°æ®_Q1-è´¢åŠ¡æ•°æ®_Q2) | å·®å¼‚% |
|---------|------------|------------|----------------------------|--------|
| å‡€åˆ©æ¶¦ | 1000000 | 1005000 | -5000 | -0.4975% |
| è¥ä¸šæ”¶å…¥ | 5000000 | 5010000 | -10000 | -0.1996% |

**å›¾ä¾‹ï¼š**
```
è´¢åŠ¡æ•°æ®_Q1=è´¢åŠ¡æ•°æ®_Q2 æˆ– |å·®å¼‚%|<1.0%  [ç»¿è‰²]
å…¶ä»–æƒ…å†µ                                 [çº¢è‰²]
```

## âœ¨ ç‰¹ç‚¹

### 1. è‡ªåŠ¨æå–
- âœ… è‡ªåŠ¨ä»å®Œæ•´è·¯å¾„ä¸­æå–æ–‡ä»¶å
- âœ… è‡ªåŠ¨ç§»é™¤ `.xlsx` å’Œ `.xls` æ‰©å±•å
- âœ… ä¿ç•™æ–‡ä»¶åçš„æ‰€æœ‰å…¶ä»–éƒ¨åˆ†ï¼ˆä¸­æ–‡ã€æ•°å­—ã€ç¬¦å·ç­‰ï¼‰

### 2. å…¼å®¹æ€§
- âœ… æ”¯æŒä¸­æ–‡æ–‡ä»¶å
- âœ… æ”¯æŒå¸¦ç©ºæ ¼çš„æ–‡ä»¶å
- âœ… æ”¯æŒå¸¦ç‰¹æ®Šå­—ç¬¦çš„æ–‡ä»¶åï¼ˆå¦‚ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦ç­‰ï¼‰
- âœ… å‘åå…¼å®¹ï¼ˆå¦‚æœæœªæä¾›æ–‡ä»¶åï¼Œé»˜è®¤ä½¿ç”¨"A"å’Œ"B"ï¼‰

### 3. æ¸…æ™°æ˜“æ‡‚
- âœ… ç”¨æˆ·ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ˜¯å“ªä¸¤ä¸ªæ–‡ä»¶çš„æ¯”å¯¹
- âœ… å·®é¢åˆ—ä¹Ÿæ¸…æ¥šæ ‡æ˜è®¡ç®—æ–¹å¼
- âœ… å›¾ä¾‹è¯´æ˜æ›´å…·ä½“

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1ï¼šå¹´åº¦å¯¹æ¯”
```
ä¸Šä¼ æ–‡ä»¶ï¼š
  - åŸºå‡†æ–‡ä»¶ï¼šæŒ‡æ ‡åˆ—è¡¨.xlsx
  - è¾“å…¥1ï¼š2024å¹´æŠ¥.xlsx
  - è¾“å…¥2ï¼š2023å¹´æŠ¥.xlsx

ç»“æœè¡¨å¤´ï¼š
| æŒ‡æ ‡åç§° | 2024å¹´æŠ¥ | 2023å¹´æŠ¥ | å·®é¢(2024å¹´æŠ¥-2023å¹´æŠ¥) | å·®å¼‚% |
```

### åœºæ™¯2ï¼šç‰ˆæœ¬å¯¹æ¯”
```
ä¸Šä¼ æ–‡ä»¶ï¼š
  - åŸºå‡†æ–‡ä»¶ï¼šbaseline.xlsx
  - è¾“å…¥1ï¼šversion_1.0.xlsx
  - è¾“å…¥2ï¼šversion_2.0.xlsx

ç»“æœè¡¨å¤´ï¼š
| æŒ‡æ ‡åç§° | version_1.0 | version_2.0 | å·®é¢(version_1.0-version_2.0) | å·®å¼‚% |
```

### åœºæ™¯3ï¼šéƒ¨é—¨å¯¹æ¯”
```
ä¸Šä¼ æ–‡ä»¶ï¼š
  - åŸºå‡†æ–‡ä»¶ï¼šKPIæŒ‡æ ‡.xlsx
  - è¾“å…¥1ï¼šé”€å”®éƒ¨_Q1.xlsx
  - è¾“å…¥2ï¼šé”€å”®éƒ¨_Q2.xlsx

ç»“æœè¡¨å¤´ï¼š
| æŒ‡æ ‡åç§° | é”€å”®éƒ¨_Q1 | é”€å”®éƒ¨_Q2 | å·®é¢(é”€å”®éƒ¨_Q1-é”€å”®éƒ¨_Q2) | å·®å¼‚% |
```

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### æ–‡ä»¶åæå–é€»è¾‘

```python
# ç¤ºä¾‹1
data_a_file = "E:\\data\\è´¢åŠ¡æ•°æ®_2024.xlsx"
data_a_name = os.path.basename(data_a_file).replace('.xlsx', '').replace('.xls', '')
# ç»“æœï¼šdata_a_name = "è´¢åŠ¡æ•°æ®_2024"

# ç¤ºä¾‹2
data_a_file = "/Users/test/æŠ¥è¡¨ Q1.xlsx"
data_a_name = os.path.basename(data_a_file).replace('.xlsx', '').replace('.xls', '')
# ç»“æœï¼šdata_a_name = "æŠ¥è¡¨ Q1"

# ç¤ºä¾‹3
data_a_file = "C:\\Users\\ææ˜\\æ¡Œé¢\\test-data.xls"
data_a_name = os.path.basename(data_a_file).replace('.xlsx', '').replace('.xls', '')
# ç»“æœï¼šdata_a_name = "test-data"
```

### Excelåˆ—å®½è‡ªåŠ¨è°ƒæ•´

ä¸ºäº†é€‚åº”ä¸åŒé•¿åº¦çš„æ–‡ä»¶åï¼Œè¡¨å¤´åˆ—å®½ä¼šè‡ªåŠ¨è°ƒæ•´ï¼š
```python
# åœ¨ _create_result æ–¹æ³•ä¸­
for col, w in enumerate([22, 18, 18, 16, 16, 16, 10], 1):
    ws.column_dimensions[get_column_letter(col)].width = w
```

**å»ºè®®ï¼š** å¦‚æœæ–‡ä»¶åç‰¹åˆ«é•¿ï¼Œå¯ä»¥è€ƒè™‘ï¼š
1. ä½¿ç”¨ç¼©å†™æˆ–ç®€çŸ­çš„æ–‡ä»¶å
2. æˆ–è€…åœ¨æœªæ¥ç‰ˆæœ¬ä¸­å®ç°è‡ªåŠ¨æ¢è¡Œ

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ–‡ä»¶åé•¿åº¦
- å¦‚æœæ–‡ä»¶åè¿‡é•¿ï¼Œè¡¨å¤´å¯èƒ½ä¼šæ˜¾å¾—æ‹¥æŒ¤
- å»ºè®®æ–‡ä»¶åé•¿åº¦æ§åˆ¶åœ¨ 20 ä¸ªå­—ç¬¦ä»¥å†…

### 2. ç‰¹æ®Šå­—ç¬¦
- å¤§éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦éƒ½æ”¯æŒ
- ä½† Excel æœ¬èº«å¯¹å•å…ƒæ ¼å†…å®¹æœ‰é™åˆ¶ï¼ˆå¦‚ä¸èƒ½åŒ…å«æŸäº›æ§åˆ¶å­—ç¬¦ï¼‰

### 3. æ‰©å±•åå¤„ç†
- åªç§»é™¤ `.xlsx` å’Œ `.xls`
- å¦‚æœæ–‡ä»¶åæœ¬èº«åŒ…å«è¿™äº›å­—ç¬¦ä¸²ï¼Œä¹Ÿä¼šè¢«ç§»é™¤
  - ä¾‹å¦‚ï¼š`data.xlsx.backup.xlsx` â†’ `data.backup`

## ğŸ¯ æœ€ä½³å®è·µ

### æ¨èçš„æ–‡ä»¶å‘½åæ–¹å¼

1. **åŒ…å«æ—¶é—´ä¿¡æ¯**
   ```
   âœ… 2024Q1_è´¢åŠ¡æ•°æ®.xlsx
   âœ… 202401_é”€å”®æŠ¥è¡¨.xlsx
   âœ… æ•°æ®_2024å¹´1æœˆ.xlsx
   ```

2. **åŒ…å«ç‰ˆæœ¬ä¿¡æ¯**
   ```
   âœ… äº§å“æ•°æ®_v1.0.xlsx
   âœ… æŠ¥è¡¨_åˆç¨¿.xlsx
   âœ… æ•°æ®_ä¿®è®¢ç‰ˆ.xlsx
   ```

3. **åŒ…å«éƒ¨é—¨/ç±»åˆ«ä¿¡æ¯**
   ```
   âœ… é”€å”®éƒ¨_Q1.xlsx
   âœ… ååŒ—åŒº_æ•°æ®.xlsx
   âœ… ç”µå•†æ¸ é“_æŠ¥è¡¨.xlsx
   ```

4. **é¿å…ä½¿ç”¨**
   ```
   âŒ æ–°å»º Microsoft Excel å·¥ä½œè¡¨.xlsx ï¼ˆå¤ªé•¿ä¸”æ— æ„ä¹‰ï¼‰
   âŒ data.xlsx ï¼ˆå¤ªç®€å•ï¼Œä¸å…·æè¿°æ€§ï¼‰
   âŒ 111.xlsx ï¼ˆæ— æ„ä¹‰ï¼‰
   ```

## ğŸ“¦ ä¿®æ”¹çš„æ–‡ä»¶

- âœ… `excel_compare_web.py`
  - ä¿®æ”¹ `run_compare` æ–¹æ³•ï¼šæå–æ–‡ä»¶å
  - ä¿®æ”¹ `_create_result` æ–¹æ³•ï¼šæ¥æ”¶å¹¶ä½¿ç”¨æ–‡ä»¶åå‚æ•°
  - æ›´æ–°è¡¨å¤´å’Œå›¾ä¾‹æ˜¾ç¤º

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯

1. **æ­£å¸¸æ–‡ä»¶å**
   - è‹±æ–‡ï¼š`test_data.xlsx`
   - ä¸­æ–‡ï¼š`æµ‹è¯•æ•°æ®.xlsx`
   - æ··åˆï¼š`test_æµ‹è¯•_2024.xlsx`

2. **ç‰¹æ®Šæƒ…å†µ**
   - å¸¦ç©ºæ ¼ï¼š`test data 2024.xlsx`
   - é•¿æ–‡ä»¶åï¼š`è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„æ–‡ä»¶åç”¨äºæµ‹è¯•æ˜¾ç¤ºæ•ˆæœ.xlsx`
   - ç‰¹æ®Šå­—ç¬¦ï¼š`æ•°æ®_2024-01-01(æœ€æ–°ç‰ˆ).xlsx`

3. **éªŒè¯å†…å®¹**
   - âœ… è¡¨å¤´ç¬¬2åˆ—æ˜¾ç¤ºæ–‡ä»¶1åç§°
   - âœ… è¡¨å¤´ç¬¬3åˆ—æ˜¾ç¤ºæ–‡ä»¶2åç§°
   - âœ… å·®é¢åˆ—æ˜¾ç¤ºæ­£ç¡®çš„è®¡ç®—è¯´æ˜
   - âœ… å›¾ä¾‹æ˜¾ç¤ºæ­£ç¡®çš„æ–‡ä»¶å

## âœ… å®ŒæˆçŠ¶æ€

- âœ… ä»£ç ä¿®æ”¹å®Œæˆ
- âœ… è¯­æ³•æ£€æŸ¥é€šè¿‡
- âœ… å…¼å®¹æ€§ä¿æŒï¼ˆé»˜è®¤å€¼ä¸º"A"å’Œ"B"ï¼‰
- âœ… ä¸­æ–‡æ–‡ä»¶åæ”¯æŒ
- â³ å¾…å®é™…æµ‹è¯•éªŒè¯

---

**æ›´æ–°æ—¥æœŸï¼š** 2026-01-03  
**ç‰ˆæœ¬ï¼š** v1.1.2  
**åŠŸèƒ½ï¼š** è¡¨å¤´æ˜¾ç¤ºå®é™…æ–‡ä»¶å  
**å½±å“èŒƒå›´ï¼š** ç»“æœExcelæ–‡ä»¶æ˜¾ç¤º

