# Excel 数据比对工具

一个功能完整的Excel数据比对工具，支持Web界面操作，跨平台运行。

## 功能特性

### 核心功能
- ✅ 基于基准列匹配两个数据源进行比对
- ✅ 自动计算差额和差异百分比
- ✅ 根据阈值自动标注颜色（绿色/红色）
- ✅ 支持自定义颜色阈值
- ✅ 生成格式化的Excel结果文件

### 智能匹配
- ✅ 忽略中划线和下划线差异（`test-data` 等同于 `test_data`）
- ✅ 按基准列顺序输出结果
- ✅ 精确匹配优先，模糊匹配兜底

### 界面特性
- ✅ 美观的Web界面，支持浏览器访问
- ✅ 文件/目录选择对话框
- ✅ 实时日志输出
- ✅ 一键生成测试文件
- ✅ 快速打开结果文件和工作目录

### 跨平台支持
- ✅ Windows
- ✅ macOS
- ✅ Linux
- ✅ 支持中文文件名和路径

## 安装依赖

```bash
pip install openpyxl==3.0.10
```

## 使用方法

### 1. 启动工具

```bash
cd /path/to/excel-tool
python excel_compare_web.py
```

启动后会自动打开浏览器访问：`http://localhost:9527`

### 2. 使用步骤

1. **设置工作目录**：选择测试文件和结果文件的保存位置
2. **准备文件**：
   - 点击"生成测试文件"生成示例数据，或
   - 手动选择三个Excel文件
3. **选择文件**：
   - 上传基准文件（纵向指标名称列表）
   - 上传输入1文件（横向数据源A）
   - 上传输入2文件（横向数据源B）
4. **设置阈值**（可选）：
   - 绿色：差异百分比 < X%（默认1%）
   - 红色：X% ≤ 差异百分比 ≤ Y%（默认1%-100%）
5. **点击"开始对比"**：生成结果文件
6. **查看结果**：点击"打开结果"查看Excel文件

## 文件格式说明

### 基准文件（纵向）
| A列 |
|-----|
| 指标名称 |
| 指标1 |
| 指标2 |
| ... |

### 输入文件（横向）
| 指标1 | 指标2 | 指标3 | ... |
|-------|-------|-------|-----|
| 值1   | 值2   | 值3   | ... |

### 输出文件
| 指标名称 | A | B | 差额 | 差异% | [图例] |
|---------|---|---|------|-------|--------|
| 指标1   | 100 | 98 | 2 | 2.04% | 差异>=1% 红色 |
| 指标2   | 50 | 50.2 | -0.2 | -0.40% | 差异<1% 绿色 |

**图例位置**：右上角（G1:H2）

## 特殊功能

### 1. 智能匹配
- `test-data` 和 `test_data` 视为相同指标
- `my-metric` 和 `my_metric` 视为相同指标

### 2. 错误处理
- 匹配不到的指标显示 `error`
- 除零等计算错误显示 `#VALUE!`

### 3. 中文支持
- ✅ 支持中文文件名
- ✅ 支持中文路径
- ✅ 支持中文指标名称

## 技术架构

- **后端**：Python 3.7+ HTTP服务器
- **前端**：纯HTML/CSS/JavaScript
- **Excel处理**：openpyxl库
- **文件对话框**：
  - macOS: AppleScript
  - Windows/Linux: tkinter（独立进程）

## 常见问题

### Q: 点击"选择文件"没有反应？
A: 确保Python已安装tkinter库。Windows用户可能需要重装Python并勾选"tcl/tk"选项。

### Q: 中文文件名显示乱码？
A: 已修复，确保使用最新版本代码。

### Q: 端口9527被占用？
A: 修改代码中的`PORT = 9527`为其他端口。

### Q: 如何停止服务器？
A: 在终端按 `Ctrl+C`

## 文件说明

- `excel_compare_web.py` - 主程序（Web服务器）
- `file_picker.py` - 文件选择工具（Windows/Linux）
- `requirements_excel_tool.txt` - 依赖列表
- `README.md` - 本文档

## 版本历史

- v1.0 (2026-01-01)
  - ✅ 基础比对功能
  - ✅ Web界面
  - ✅ 跨平台支持
  - ✅ 智能匹配（忽略中划线/下划线）
  - ✅ 图例右上角显示
  - ✅ 中文文件名支持

## 许可证

MIT License

