# Excel比对工具 - 快速使用指南

## 🚀 启动程序

```bash
cd /Users/li.wang/ai-test-project/excel-tool
python3 excel_compare_web.py
```

浏览器访问：`http://localhost:9527`

## 📝 主要修改（v1.1.0）

### 1. 百分比计算公式变更 ⭐
```
旧公式: 差异% = (A-B) / B × 100
新公式: 差异% = (A-B) / A × 100
```

**差异说明：**
- **旧逻辑**：以B（期望值）为基准
- **新逻辑**：以A（实际值）为基准，表示"实际值相对自身的差异"

**示例对比：**
| A | B | 旧公式结果 | 新公式结果 |
|---|---|-----------|-----------|
| 1100 | 1000 | +10% | +9.09% |
| 900 | 1000 | -10% | -11.11% |

### 2. 小数位数可配置 ⭐
- **默认值**：6位小数
- **范围**：0-10位
- **应用**：差额和百分比都使用此设置

### 3. 颜色逻辑简化 ⭐
```
✅ 绿色: A = B  或  |差异%| < 阈值
❌ 红色: 其他所有情况
```

**关键点：**
- A=B 时强制为绿色（即使计算为0%也明确标绿）
- 不再有"无色"区域
- 阈值默认1%，可在界面调整

## 🎯 使用步骤

### 步骤1：选择工作目录
点击「选择目录」按钮，选择文件存放位置

### 步骤2：上传文件
- **基准文件**：纵向表格，包含所有需要比对的指标名称
- **输入1文件（A）**：横向表格，包含A组数据
- **输入2文件（B）**：横向表格，包含B组数据

### 步骤3：配置参数
```
小数位数: [6]     ← 输入0-10的整数
阈值:    [1.0] %  ← 输入百分比阈值
```

### 步骤4：运行比对
点击「🚀 开始对比」按钮

### 步骤5：查看结果
点击「打开结果」按钮，或在工作目录中找到 `compare_result.xlsx`

## 📊 结果文件说明

### 表格结构
| 列名 | 说明 | 示例 |
|------|------|------|
| 指标名称 | 来自基准文件 | "净利润" |
| A | 输入1文件的值 | 1005.123456 |
| B | 输入2文件的值 | 1000.000000 |
| 差额(A-B) | A减B的差值 | 5.123456 |
| 差异% | (A-B)/A×100 | 0.509876% |

### 颜色标记
- 🟢 **绿色背景**：A=B 或 差异百分比绝对值 < 阈值
- 🔴 **红色背景**：差异百分比绝对值 ≥ 阈值
- 📋 **图例位置**：Excel右上角（G1:H2）

### 特殊值
- `error`：在基准文件中找不到对应值
- `#VALUE!`：无法计算（如A=0时无法计算百分比）

## 🧪 测试功能

点击「生成测试文件」按钮，自动生成：
- `test_base.xlsx` - 基准文件
- `test_data_a.xlsx` - 输入1文件
- `test_data_b.xlsx` - 输入2文件

包含各种边界场景（匹配/不匹配、正负差异、零值等）

## 🔍 常见问题

### Q1：为什么同样的A和B，结果和之前不一样？
**A：** 百分比计算公式从 `(A-B)/B` 改为 `(A-B)/A`，以A为基准更合理

### Q2：A=B时为什么是绿色？
**A：** 新逻辑规定：A=B时强制为绿色，表示"完全一致"

### Q3：小数位数有什么用？
**A：** 控制差额和百分比的显示精度：
- 金融场景：建议6-8位
- 一般场景：建议2-4位

### Q4：阈值如何设置？
**A：** 根据业务需求：
- 严格场景：0.1% 或 0.5%
- 一般场景：1.0%（默认）
- 宽松场景：2.0% 或 5.0%

### Q5：文件名是中文会报错吗？
**A：** 已修复，支持中文文件名和路径

### Q6：Windows上能用吗？
**A：** 完全支持Windows、macOS、Linux

## 🛠️ 高级功能

### 1. 指标名匹配规则
- 精确匹配优先
- 自动忽略**下划线**差异（不忽略中划线）
- 示例：
  - ✅ `净利润` 可匹配 `净_利_润`
  - ❌ `净利润` 不能匹配 `净-利-润`

### 2. 命令行日志
界面下方的日志区域实时显示：
- 文件读取状态
- 匹配数量统计
- 错误提示
- 完成信息

### 3. 重复比对
修改文件内容后，可直接再次点击「开始对比」，会重新读取文件并覆盖结果文件

## 📦 打包为可执行文件

如需在无Python环境的机器上运行，可打包为exe/app：

```bash
# 安装打包依赖
pip install -r requirements_build.txt

# 执行打包
python build.py

# 结果在 dist/ 目录
```

详见 `BUILD_GUIDE.md`

## 📞 技术支持

如遇问题：
1. 查看界面日志输出
2. 检查文件格式是否正确
3. 确认Python版本（建议3.7+）
4. 查看 `更新说明-计算逻辑修改.md` 了解详细改动

---

**版本：** v1.1.0  
**更新日期：** 2026-01-03  
**兼容性：** Windows / macOS / Linux

